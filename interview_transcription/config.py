"""
配置管理模块
管理讯飞API密钥和系统参数
"""

import os
from pathlib import Path

# 尝试加载 dotenv（可选依赖）
try:
    from dotenv import load_dotenv
    load_dotenv()
except ImportError:
    # 如果没有安装 python-dotenv，跳过
    pass


class Config:
    """系统配置类"""
    
    # ============ 讯飞API配置 ============
    # 请在.env文件中设置，或直接在这里填写
    IFLYTEK_APPID = os.getenv('IFLYTEK_APPID', 'c0d9df4d')
    # IFLYTEK_SECRET_KEY = os.getenv('IFLYTEK_SECRET_KEY', '206af4dddefea1c442f33f39c11ad96f')
    
    # 大模型API（新版，推荐）
    IFLYTEK_API_KEY = os.getenv('IFLYTEK_API_KEY', '206af4dddefea1c442f33f39c11ad96f')
    IFLYTEK_API_SECRET = os.getenv('IFLYTEK_API_SECRET', 'ZDdkNDE2NTQxNDhhYzI1ZGMwOTA0ZGJh')
    
    # ============ 音频参数 ============
    SUPPORTED_FORMATS = ['.mp3', '.wav', '.m4a', '.flac']
    MAX_FILE_SIZE = 500 * 1024 * 1024  # 500MB
    
    # ============ 转写参数 ============
    # 是否开启说话人分离（两人对话必须开启）
    ENABLE_SPEAKER_SEPARATION = True
    # 说话人数量
    SPEAKER_NUMBER = 2
    # 语言（中文）
    LANGUAGE = 'zh_cn'
    # 是否加标点
    HAS_PARTICIPLE = True
    
    # ============ 文本清洗参数 ============
    FILLER_WORDS = [
        "啊", "嗯", "呃", "喔", "哦", "呀", "啦", "嘛", "哈", "嘿", "吧", "呢", "咧", "噻", "哎", "喂", "哼", "呣", "呦", "哇", "唔",
        "这个", "那个", "然后", "就是", "就是说", "相当于", "反正", "对不对", "明白吗", "知道吧", "听懂吗", "你懂的", "其实", "说实话",
        "嗯嗯", "对对", "好好", "行行", "可以可以", "是的", "确实", "没错", "当然", "本来", "基本上", "总体来讲", "某种程度上", "大体上",
        "这种", "那种", "反正就是", "那么", "反正就", "可以说", "怎么说呢", "怎么讲", "就是这么个意思", "是吧"
    ]
    
    COLLOQUIAL_TO_FORMAL = {
        "您": "你", "咱们": "我们", "人家": "他人", "大家": "众人",
        "咋": "怎么", "咋样": "怎么样", "干啥": "做什么", "弄啥": "做什么", "说啥": "说什么",
        "这会儿": "现在", "那会儿": "那时", "一会儿": "稍后", "啥时候": "什么时候",
        "赶紧": "立刻", "立马": "立即", "回头": "以后", "寻思": "考虑", "琢磨": "思考",
        "打比方": "例如", "打个比方": "例如", "好比": "如同", "就是说": "即是说",
        "特别": "非常", "老是": "总是", "总是": "经常", "怪": "很", "贼": "非常",
        "有点儿": "有些", "一会儿": "片刻", "一下子": "立刻", "一劲儿": "一直",
        "挺": "很", "特": "很", "蛮": "很", "倍儿": "特别",
        "这不": "因此", "那不": "因此", "可不": "当然",
        "给力": "有效", "靠谱": "可靠", "忽悠": "欺骗", "摆谱": "炫耀", "扯淡": "胡说",
        "咋回事": "怎么回事", "有啥": "有什么", "干嘛": "做什么", "没啥": "没什么",
        "不管咋样": "无论如何", "总而言之": "总之", "总的来说": "总而言之", "一般来讲": "一般而言",
        "基本上": "大体上", "反正": "总之", "其实": "实际上", "说实话": "坦白说",
        "搞": "做", "搞定": "完成", "搞清楚": "弄明白",
        "瞅": "看", "瞧": "看", "寻思": "思考", "琢磨": "思考", "唠嗑": "聊天",
        "瞅着": "看着", "寻思着": "思考着", "琢磨着": "思考着",
        "是不是": "是否", "对不对": "是否", "行不行": "是否可行", "要不要": "是否需要",
        "来着": "用于表示过去的事情", # 这个比较特殊，可能需要上下文判断
        "好啦": "好了", "行啦": "行了", "算了": "作罢",
        "有点儿": "有些", "一些": "一些", "一些个": "一些",
        "这啊": "这", "那啊": "那", "啥啊": "什么",
        "就": "就", "是": "是", "呀": "啊", # 语气词
        "然后": "然后", "接着": "接着", "后来": "后来", # 连接词
        "所以说": "因此", "就是说": "即是说", "换句话说": "换言之",
        "说实话": "坦白地说", "老实说": "实话说",
        "哎": "（感叹词）", "嗯": "（语气词）", "哦": "（语气词）", "呀": "（语气词）",
        "那个": "那个", "这儿": "这里", "那儿": "那里", "一会儿": "片刻",
        "有点儿": "稍微有点", "稍微有点": "稍微有点",
        "挺": "很", "蛮": "很", "特别": "非常",
        "毕竟": "毕竟", "到底": "究竟", "反正": "总之", "其实": "实际上",
        "这样子": "这样", "那样子": "那样",
        "多少": "多少", "一些": "一些", "一些些": "一些",
        "什么样子": "什么样", "怎么样": "怎么样",
        "是吧": "对吧", "对吧": "对吧", "好吧": "好吧",
        "好的": "好的", "没问题": "没问题", "可以": "可以",
        "那": "那", "就": "就",
        "哎呀": "哎呀", "天哪": "天哪", "哦天哪": "哦天哪"
    }
    
    REPEAT_THRESHOLD = 3

    # ============ 智谱AI配置 ============
    ZHIPU_API_KEY = os.getenv('ZHIPU_API_KEY', 'dfabbf5e418647a1b6618619ec26ce64.qfhvaSesDwlL1EYm')
    ZHIPU_MODEL = os.getenv('ZHIPU_MODEL', 'glm-4-flash')  # 可选: glm-4, glm-4-flash
    ZHIPU_BASE_URL = 'https://open.bigmodel.cn/api/paas/v4'
    
    # ============ 任务轮询参数 ============
    POLL_INTERVAL = 5  # 秒
    MAX_POLL_TIME = 3600  # 最长等待1小时
    
    @classmethod
    def validate(cls):
        """验证必要配置是否完整"""
        errors = []
        
        if not cls.IFLYTEK_APPID:
            errors.append("缺少 IFLYTEK_APPID")
        if not cls.IFLYTEK_API_KEY:
            errors.append("缺少 IFLYTEK_API_KEY")
        if not cls.IFLYTEK_API_SECRET:
            errors.append("缺少 IFLYTEK_API_SECRET")
        
        if errors:
            raise ValueError(f"配置错误: {', '.join(errors)}")
        
        return True

